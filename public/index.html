<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KashFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="stylesheet" href="./css/journal.css" />
  </head>
  <body>
    <div id="particles-js" class="position-absolute top-0 start-0 w-100 h-100"></div>
    
    <!-- Header -->
    <header class="container-fluid py-1 bg-dark bg-opacity-75">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="text-white mb-0 d-flex align-items-center" style="font-family: 'Poppins', sans-serif; font-weight: 600; letter-spacing: 0.5px;">
            <img src="icons/favicon.ico" alt="KashFlow" class="me-3" style="height: 40px; width: auto;">
            KashFlow
          </h1>
        </div>
        <div class="col-md-4 text-end">
          <button id="manage-accounts-button" class="btn btn-outline-info me-2" title="Gestionar Cuentas">
            <i class="bi bi-bank me-2"></i>Gestionar Cuentas
          </button>
          <button id="refresh-button" class="btn btn-outline-light" title="Actualizar">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Filtros y Resumen -->
    <div class="container-lg mt-4">
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card bg-dark bg-opacity-75">
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label text-white">Desde:</label>
                  <input type="date" id="dateFrom" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <label class="form-label text-white">Hasta:</label>
                  <input type="date" id="dateTo" class="form-control form-control-sm">
                </div>
                <div class="col-md-4">
                  <label class="form-label text-white">Buscar:</label>
                  <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Descripción...">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicadores Principales -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card bg-primary bg-opacity-75">
            <div class="card-body text-center">
              <h6 class="card-title text-white mb-1">
                <i class="bi bi-wallet2 me-2"></i>Saldo Total
              </h6>
              <h4 id="totalBalance" class="text-white mb-0 fw-bold">$0.00</h4>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-success bg-opacity-75">
            <div class="card-body text-center">
              <h6 class="card-title text-white mb-1">
                <i class="bi bi-arrow-up-circle me-2"></i>Ingresos Mes
              </h6>
              <h4 id="monthlyIncome" class="text-white mb-0 fw-bold">$0.00</h4>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-danger bg-opacity-75">
            <div class="card-body text-center">
              <h6 class="card-title text-white mb-1">
                <i class="bi bi-arrow-down-circle me-2"></i>Gastos Mes
              </h6>
              <h4 id="monthlyExpenses" class="text-white mb-0 fw-bold">$0.00</h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicadores Secundarios: Top 3 Cuentas -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card bg-dark bg-opacity-75">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="text-white mb-0">
                  <i class="bi bi-bank me-2"></i>Cuentas con Mayor Saldo
                </h6>
                <!-- Botón Ver Todos -->
                <button 
                  class="btn btn-sm btn-outline-light" 
                  data-bs-toggle="modal" 
                  data-bs-target="#allAccountsModal"
                  title="Ver todas las cuentas">
                  <i class="bi bi-list-ul me-1"></i>Ver todos
                </button>
              </div>
              <div class="row g-3" id="topAccountsContainer">
                <!-- Se llenará dinámicamente -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Libro Diario -->
      <div class="card bg-dark bg-opacity-75">
        <div class="card-header">
          <h5 class="text-white mb-0">
            <i class="bi bi-journal-bookmark me-2"></i>
            Registro de Movimientos
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-dark table-striped table-hover mb-0">
              <thead>
                <tr>
                  <th style="width: 12%">Fecha</th>
                  <th style="width: 40%">Descripción</th>
                  <th style="width: 18%">Cuenta</th>
                  <th style="width: 26%">Monto</th>
                  <th style="width: 4%">Acciones</th>
                </tr>
              </thead>
              <tbody id="transactionTable">
                <!-- Transacciones dinámicas -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Ver Todas las Cuentas -->
    <div class="modal fade" id="allAccountsModal" tabindex="-1" aria-labelledby="allAccountsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="allAccountsModalLabel">
              <i class="bi bi-bank me-2"></i>Resumen de Todas las Cuentas
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
              <table class="table table-dark table-hover mb-0">
                <thead class="sticky-top bg-dark">
                  <tr>
                    <th>Cuenta</th>
                    <th class="text-end">Saldo</th>
                    <th class="text-center">Estado</th>
                  </tr>
                </thead>
                <tbody id="allAccountsTableBody">
                  <!-- Se llenará dinámicamente (máximo 5 visibles con scroll) -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Gestionar Cuentas -->
    <div class="modal fade" id="manageAccountsModal" tabindex="-1" aria-labelledby="manageAccountsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="manageAccountsModalLabel">
              <i class="bi bi-bank me-2"></i>Gestión de Cuentas
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="text-white mb-0">Cuentas Registradas</h6>
              <button class="btn btn-success" id="newAccountBtn">
                <i class="bi bi-plus-lg me-2"></i>Nueva Cuenta
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-dark table-hover mb-0">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Alias</th>
                    <th>Color</th>
                    <th>Moneda</th>
                    <th>Usuario</th>
                    <th class="text-end">Saldo</th>
                    <th class="text-center">Estado</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody id="accountsManagementTableBody">
                  <!-- Se llenará dinámicamente -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Crear/Editar Cuenta -->
    <div class="modal fade" id="accountFormModal" tabindex="-1" aria-labelledby="accountFormModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="accountFormModalLabel">
              <i class="bi bi-plus-circle me-2"></i>Nueva Cuenta
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="accountForm">
              <input type="hidden" id="accountId">
              
              <div class="mb-3">
                <label for="accountUsuario" class="form-label text-white">Usuario:</label>
                <select class="form-select" id="accountUsuario" required>
                  <option value="">Seleccionar usuario...</option>
                  <!-- Se llenará dinámicamente -->
                </select>
              </div>
              
              <div class="mb-3">
                <label for="accountNombre" class="form-label text-white">Nombre de la Cuenta:</label>
                <input type="text" class="form-control" id="accountNombre" placeholder="Ej: Banco BBVA Francés" required>
              </div>
              
              <div class="mb-3">
                <label for="accountAlias" class="form-label text-white">Alias (para mensajes):</label>
                <input type="text" class="form-control" id="accountAlias" placeholder="Ej: BBVA" required>
                <small class="text-muted">Este es el nombre corto que usarás en los mensajes de Telegram</small>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="accountColor" class="form-label text-white">Color:</label>
                    <input type="color" class="form-control form-control-color" id="accountColor" value="#4CAF50" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="accountMoneda" class="form-label text-white">Moneda:</label>
                    <select class="form-select" id="accountMoneda" required>
                      <option value="ARS">ARS - Peso Argentino</option>
                      <option value="USD">USD - Dólar</option>
                      <option value="EUR">EUR - Euro</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div class="alert alert-info" role="alert">
                <i class="bi bi-info-circle me-2"></i>
                El alias debe ser único y se usará para registrar transacciones desde Telegram
              </div>
            </form>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-success" id="saveAccountBtn">
              <i class="bi bi-save me-2"></i>Guardar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Agregar/Editar Transacción -->
    <!-- <div class="modal fade" id="addTransactionModal" tabindex="-1" aria-labelledby="addTransactionModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="addTransactionModalLabel">Nueva Transacción</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="transactionForm">
              <input type="hidden" id="transactionId">
              <div class="mb-3">
                <label for="transactionDate" class="form-label text-white">Fecha:</label>
                <input type="date" class="form-control" id="transactionDate" required>
              </div>
              <div class="mb-3">
                <label for="transactionDescription" class="form-label text-white">Descripción:</label>
                <input type="text" class="form-control" id="transactionDescription" placeholder="Descripción de la transacción" required>
              </div>
              <div class="mb-3">
                <label for="transactionAccount" class="form-label text-white">Cuenta:</label>
                <select class="form-select" id="transactionAccount" required>
                  <option value="">Seleccionar cuenta...</option>
                  <option value="UALA">Ualá</option>
                  <option value="MERCADOPAGO">MercadoPago</option>
                  <option value="BBVA">BBVA</option>
                  <option value="LEMON">Lemon</option>
                  <option value="NARANJAX">NaranjaX</option>
                  <option value="EFECTIVO">Efectivo</option>
                </select>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="transactionDebit" class="form-label text-white">Debe (Ingreso):</label>
                    <input type="number" step="0.01" class="form-control" id="transactionDebit" placeholder="0.00">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="transactionCredit" class="form-label text-white">Haber (Egreso):</label>
                    <input type="number" step="0.01" class="form-control" id="transactionCredit" placeholder="0.00">
                  </div>
                </div>
              </div>
              <div class="text-muted small mb-3">
                <i class="bi bi-info-circle me-1"></i>
                Ingrese el monto solo en uno de los campos (Debe para ingresos, Haber para gastos)
              </div>
            </form>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-success" id="saveTransactionBtn">Guardar</button>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Plantilla de fila de transacción -->
    <template id="transaction-row-template">
      <tr>
        <td class="date"></td>
        <td class="description"></td>
        <td class="account">
          <span class="badge account-badge"></span>
        </td>
        <td class="amount"></td>
        <td class="actions text-center">
          <button class="btn btn-sm btn-outline-warning mb-1 edit-btn" title="Editar">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger delete-btn" title="Eliminar">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/particles/particles.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/accounts.js"></script>
    <script src="js/accounts-crud.js"></script>
    <script src="js/journal.js"></script>
  </body>
</html>